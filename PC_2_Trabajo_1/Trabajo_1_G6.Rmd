---
title: "**Trabajo 1 - Teor√≠a de Muestreo**"
author: "Grupo 6: <br> - Fernando Mendoza [20105246] <br> - Luis Egusquiza [20193469] <br> - Pamela Salazar [20181281]  <br> - Julian Zavala [F1032805]"
date: "`r Sys.Date()`"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

## **Parte I (5 puntos)**

Responda en m√°ximo 80 palabras **dos** de las siguientes preguntas

1. Explique en sus propias palabras las diferencias entre dominio y estrato. Utilice ejemplos no discutidos durante las clases te√≥ricas.

Si estamos analizando los datos de una encuesta de satisfacci√≥n del cliente sobre una p√°gina web o tienda online, el dominio corresponde a comercio electr√≥nico en atenci√≥n al √°rea de aplicaci√≥n y/o tipo de datos a tratar. Por otra parte, el estrato podr√≠a comprender a los clientes con compras mayores de una cantidad X, es decir se tratar√≠a de una subcategor√≠a dentro de los datos del dominio.
En s√≠ntesis, el dominio es el campo espec√≠fico de inter√©s, mientras el estrato comprende una partici√≥n o grupo con caracter√≠sticas similares.


2. ¬øQu√© esperar√≠a que ocurra con la varianza de una variable cuando se aplique un muestreo aleatorio clusterizado (MAC) en lugar de un muestreo aleatorio estratificado (MAE)? ¬øPor qu√©?

Primero, en el MAE, la poblaci√≥n de la muestra se divide en grupos homog√©neos llamados "estratos".
Luego, en el MAC, los clusters suelen ser heterog√©neos y las observaciones en un mismo cluster suelen ser similares entre s√≠, por lo cual, aumenta la varianza.

3. Explique, con sus propias palabras, por qu√© se espera que el efecto dise√±o (*ùëëùëíùëìùëì*) en un MAE sea menor o igual que 1.

Primero, el efecto dise√±o est√° dado por la relaci√≥n entre la varianza de la estimaci√≥n bajo el dise√±o complejo y la varianza bajo el muestreo aleatorio simple. Adem√°s, se infiere que el MAE presenta grupos homog√©neos la variabilidad se reduce y las estimaciones tienden a ser m√°s precisas, por cuanto la varianza tiende a reducirse. En otros t√©rminos, se presume que la MAE es m√°s eficiente que el muestreo aleatorio simple.

4. ¬øEn qu√© caso el muestreo aleatorio por conglomerados tiende a aumentar la precisi√≥n de las estimaciones?

Se tendr√°n que presentar dos condiciones, que los conglomerados sean muy heterog√©neos entre s√≠ y que los elementos de los conglomerados sean relativamente homog√©neos. Puesto que si seleccionamos un n√∫mero de conglomerados representativos de una muestra, y la diferencia entre estos, es probable que las estimaciones sean muy precisas.

## **Parte II (5 puntos)**

**1.** Descargue el Censo Nacional de Poblaci√≥n Penitenciaria 2016 de la p√°gina del INEI (https://proyectos.inei.gob.pe/microdatos/). Puede descargar solo la car√°tula o tambi√©n m√°s m√≥dulos de dicho censo.
```{r, message=FALSE}
library(dplyr)
library(haven)
library(archive)

setwd("C:/Users/mendo/OneDrive/Desktop/GitHub/10-Big_Data_et_Analytics/PC_2")

# URL del archivo en Github
url_1 <- "https://github.com/MendozaC25/10-Big_Data_et_Analytics/raw/refs/heads/main/PC_2/01_PENALES_CARATULA.rar"

# Nombre del archivo de destino
destfile_1 <- "01_PENALES_CARATULA.rar"

# Descargar el archivo
download.file(url_1, destfile_1, mode = "wb")

# Extraer archivos
archive_extract("01_PENALES_CARATULA.rar")
archive_extract("01_PENALES_CAP100.rar")

df <- read_sav("01_PENALES_CARATULA.sav")

file.remove("01_PENALES_CARATULA.sav")

n_registros <- nrow(df)
n_registros
```
**2.** Genere una variable dicot√≥mica con el valor de 1 para quienes cometen ‚ÄúDelitos contra la seguridad p√∫blica‚Äù, y 0 para el resto de casos. Llamar a esta variable `pp_dcsp`

```{r}
df_SP <- df |>
  mutate(
    pp_dcsp = ifelse(DELITO_GENERICO == "DELITOS CONTRA LA SEGURIDAD PUBLICA", 
                     1, 
                     0)
  )

print("pp_dcsp")
summary(df_SP$pp_dcsp)

```
**3.** Establezca una semilla (‚Äúseed‚Äù) usando los d√≠gitos 12345.

Con el comando `set.seed()` establecemos una semilla.
```{r}
set.seed(12345)

```
**4.** Extraiga una muestra estratificada y por conglomerados que contenga entre el 3% y 5% de la poblaci√≥n (toda la base). Justifique la elecci√≥n de las variables para los estratos y conglomerados. Discuta tambi√©n, de ser el caso, qu√© otras variables que podr√≠an haberse utilizado para los estratos o conglomerados.

Un estrato es una subpoblaci√≥n homog√©nea dentro de la cual se selecciona una muestra representativa. Se utiliza cuando se busca garantizar la adecuada representaci√≥n de ciertos grupos dentro de la muestra.

En este caso, la variable `EDAD` se ha utilizado para crear `Edad_Estr` como variable de estratificaci√≥n. Esta elecci√≥n se justifica porque existen diferencias significativas entre los perfiles delictivos y las condiciones carcelarias seg√∫n la edad.

- La edad influye en el tipo de delitos cometidos, el comportamiento dentro de prisi√≥n y las necesidades de rehabilitaci√≥n.
- Los reclusos j√≥venes (18-30 a√±os) suelen estar m√°s involucrados en delitos violentos o relacionados con pandillas, mientras que los de mayor edad pueden estar m√°s asociados a delitos financieros o de corrupci√≥n.
- Al estratificar por edad, aseguramos que los diferentes grupos etarios est√©n representados en la muestra de manera proporcional, evitando sesgos.

Otras variables que tambi√©n podr√≠an haberse utilizado como estratos incluyen religi√≥n (`RELIGION`), estado civil (`E_CIVIL`) o g√©nero (`GENERO`), ya que pueden influir en la din√°mica carcelaria y en la reinserci√≥n social de los reclusos.
```{r, message=FALSE}
# Estrato
df_SP$Edad_Estr <- cut(df_SP$EDAD, breaks = c(0, 30, 45, 60, Inf), 
                          labels = c("18-30", "31-45", "46-60", "60+"), 
                          right = FALSE)

# Opci√≥n 1: Eliminar registros con NA en `Edad_Estr`
df_SP <- df_SP %>% filter(!is.na(Edad_Estr))

summary(df_SP$Edad_Estr)
```
Un conglomerado es un grupo natural dentro de la poblaci√≥n en el que se seleccionan unidades completas. Se utiliza cuando existen grandes diferencias entre los grupos, pero cada grupo interno es relativamente homog√©neo.

En este caso, se ha elegido `OF_REGIONAL` (la oficina regional) como variable de conglomerados, y su selecci√≥n se justifica por la estructura descentralizada de la administraci√≥n penitenciaria en Per√∫:

- El sistema penitenciario est√° distribuido en distintas oficinas regionales, cada una encargada de gestionar las c√°rceles dentro de su jurisdicci√≥n.
- Factores como las condiciones carcelarias, la sobrepoblaci√≥n y los programas de rehabilitaci√≥n pueden variar significativamente entre regiones.
- Al usar `OF_REGIONAL` como conglomerado, capturamos estas diferencias estructurales sin afectar la representatividad dentro de cada regi√≥n.

Otras variables que tambi√©n podr√≠an haberse utilizado como conglomerados incluyen el pabell√≥n en el que se encuentra el reo (`PABELLON`) o el nombre del establecimiento penitenciario (`EST_PENIT`), ya que ambos agrupan a los internos en unidades naturales con caracter√≠sticas espec√≠ficas.
```{r}
summary.factor(df_SP$OF_REGIONAL)

```
Lo siguiente es la muestra que se obtiene estratificada y por conglomerado con un oporcentaje aleatorio entre 3% y 5% de la poblaci√≥n.
```{r}
# Seleccionar porcentaje aleatorio entre 3% y 5%
muestra_prop <- runif(1, 0.03, 0.05)

# Muestreo estratificado y por conglomerados
muestra_final <- df_SP |>
  group_by(OF_REGIONAL, Edad_Estr) |>  # Estratificaci√≥n por regi√≥n y edad
  slice_sample(prop = muestra_prop) |> # Selecci√≥n de muestra proporcional
  ungroup()

# Verificar el tama√±o de la muestra final
nrow(muestra_final) / nrow(df_SP) * 100  # Porcentaje de la muestra

```
**5.** Declare el dise√±o muestral completo y calcale las siguientes estad√≠sticas (deben ser representativas):
```{r, message=FALSE}
library(survey)

diseno_muestral <- svydesign(
  id = ~OF_REGIONAL,      # Conglomerado: Oficina Regional
  strata = ~Edad_Estr,    # Estratos: Grupo de edad
  data = df_SP,           # Base de datos muestral
  weights = ~1,           # Peso muestral (asumimos igual probabilidad)
  nest = TRUE             # Permite que estratos sean anidados en conglomerados
)

```
  - a. El porcentaje de personas que cometi√≥ ‚ÄúDelitos contra la seguridad p√∫blica‚Äù

Resultado: 25.37%
Intervalo de error est√°ndar: ¬±1.68%

Se puede ver que aproximadamente 1 de cada 4 personas en la poblaci√≥n penitenciaria ha sido encarcelada por delitos contra la seguridad p√∫blica.
```{r}
svymean(~pp_dcsp, diseno_muestral)

```
  - b. El total de personas que cometi√≥ ‚ÄúDelitos contra la seguridad p√∫blica‚Äù
  
Resultado: 19,315 personas
Error est√°ndar: 4,896 personas
Se estima que aproximadamente 19,315 personas en la poblaci√≥n total de internos han cometido este tipo de delito. Sin embargo, debido a la naturaleza del muestreo, esta cifra tiene una variabilidad de ¬±4,896, lo que significa que el total real podr√≠a estar entre 14,419 y 24,211 personas.
```{r}
svytotal(~pp_dcsp, diseno_muestral)

```
## **Parte III (5 puntos)**

Explique el objetivo, la poblaci√≥n objetivo, macro muestral, el dise√±o muestral de la encuesta y las unidades de muestreo. Luego, declare el dise√±o muestral (**completo**). Explique los niveles de inferencia, construcci√≥n de pesos y tasa de no respuesta. Para esto, se recomienda revisar la ficha t√©cnica de la encuesta.

**Nombre de la Encuesta: Segunda Encuesta Mundial a la Comunidad Peruana en el Exterior 2021**

- **Objetivo: **
Obtener informaci√≥n actualizada sobre las principales caracter√≠sticas demogr√°ficas, sociales, econ√≥micas y la situaci√≥n migratoria de la Comunidad Peruana en el Exterior, as√≠ como su grado de vinculaci√≥n con el Per√∫ y la percepci√≥n acerca de los servicios ofrecidos en los diferentes consulados alrededor del mundo.

- **Poblaci√≥n objetivo:**
Compuesta por peruanos/as que nacieron en el Per√∫ y residen en un pa√≠s distinto y/o aquellas personas nacidas en un pa√≠s distinto al Per√∫ y que tienen la nacionalidad peruana.

- **Marco muestral:**
Se bas√≥ en la informaci√≥n proporcionada por el Registro Nacional de Identificaci√≥n y Estado Civil (RENIEC), que identific√≥ a 1,006,576 peruanos de 18 a√±os y m√°s con Documento Nacional de Identidad (DNI) residiendo en el exterior.

- **Dise√±o muestral:**
No probabil√≠stico por cuotas de g√©nero y grupos de edad. Se utiliz√≥ para el recojo de informaci√≥n el autoempadronamiento mediante formularios virtuales o impresos.

- **Unidades de muestreo:**
Los/as peruano/as mayores de 18 a√±os residentes en el exterior identificados en el marco del RENIEC.

- **Dise√±o muestral completo:**
La encuesta se realiz√≥ en 63 pa√≠ses de Europa, Asia, √Åfrica, Ocean√≠a y Am√©rica, correspondiente a 115 Consulados del Ministerio de Relaciones Exteriores del Per√∫. En ese sentido, se distribuy√≥ la muestra de manera representativa por continente, pa√≠s, ciudad y consulado. Adicionalmente a ello, se realiz√≥ un rec√°lculo de las cuotas por g√©nero y grupo de edad, dado que se tuvo la dificultad de localizar a los peruanos en sus lugares de residencia. As√≠, se seleccion√≥ un tama√±o de muestra de 10,084 personas de un total de 12,000 peruanos registrados en la encuesta online.

- **Niveles de inferencia:**
Abarca los cinco continentes donde residen los peruanos (Am√©rica, Europa, Asia, √Åfrica y Ocean√≠a) y se desglosan a nivel de pa√≠s, ciudad y consulado.

- **Construcci√≥n de pesos:**
En el documento no se especifica la metodolog√≠a espec√≠fica de construcci√≥n de pesos.

- **Tasa de no respuesta:**
El documento no especifica una tasa de no respuesta.

## **Parte IV (5 puntos)**

Responder uno de los siguientes bloques de preguntas (elija entre Bloque A o Bloque B). Prestar atenci√≥n al l√≠mite de palabras de cada pregunta.

### **BLOQUE B**

#### Pregunta 1 (Palabras: 300)

Suponga que usted es ascendido como muestrista principal en el Ministerio de Salud (Minsa). Su primera tarea es terminar de definir el dise√±o de una encuesta probabil√≠stica para medir el nivel de desnutrici√≥n en ni√±os de educaci√≥n primaria. El anterior muestrista hab√≠a sugerido un dise√±o por conglomerados donde los conglomerados sean los distritos.
Discuta si esta opci√≥n le parece la m√°s id√≥nea. ¬øQu√© beneficios y/o perjuicios traer√≠a hacerlo de dicho modo? Adem√°s, si usted considera que hay otra opci√≥n, explique cu√°l ser√≠a y por qu√©. Incluya los conceptos de UPM y USC.
Suponga, adem√°s, que su superior le dice que han aumentado el presupuesto para el estudio, por lo cual pueden incrementar el tama√±o de muestra calculado por el anterior muestrista. En ese sentido, le consulta si resulta m√°s conveniente aumentar los conglomerados o m√°s bien el n√∫mero de estudiantes dentro de cada conglomerado.
Argumente su respuesta.

Discuta las ventajas y/o desventajas del dise√±o planteado por al anterior muestrista (dise√±o por conglomerados) frente a un dise√±o por estratos. De optar por un dise√±o por estratos, cu√°les ser√≠an las ventajas y desventajas frente al dise√±o inicialmente planteado. Incluya conceptos como homogeneidad, heterogeneidad, efecto de dise√±o.

-**Respuesta:**

El dise√±o por conglomerados propuesto, donde los distritos son las unidades primarias de muestreo (UPM), tiene ventajas pr√°cticas pero tambi√©n desaf√≠os metodol√≥gicos.

**Ventajas del dise√±o por conglomerados**

1. **Practicidad log√≠stica:** Los distritos agrupan escuelas y estudiantes, facilitando la recolecci√≥n de datos al reducir costos y tiempo de desplazamiento.
2. **Adaptabilidad:** Permite seleccionar aleatoriamente escuelas dentro de los distritos seleccionados como unidades secundarias de muestreo (USC), lo que simplifica el proceso.

**Desventajas del dise√±o por conglomerados**

1. **Efecto de dise√±o:** Los ni√±os dentro de un mismo distrito tienden a ser m√°s homog√©neos en caracter√≠sticas relevantes (e.g., acceso a servicios de salud, condiciones socioecon√≥micas), lo que reduce la eficiencia estad√≠stica en comparaci√≥n con dise√±os m√°s dispersos.
2. **Menor precisi√≥n:** La homogeneidad intra-conglomerado puede requerir muestras m√°s grandes para alcanzar el mismo nivel de precisi√≥n.

**Alternativa: Dise√±o estratificado**

Un dise√±o estratificado dividir√≠a la poblaci√≥n en estratos seg√∫n criterios relevantes (e.g., regi√≥n geogr√°fica, nivel socioecon√≥mico, tipo de escuela: rural/urbana). Dentro de cada estrato, se seleccionan muestras independientes.

**Ventajas del dise√±o estratificado**

- **Mayor precisi√≥n:** Aumenta la heterogeneidad entre estratos y homogeneidad dentro de ellos, mejorando la estimaci√≥n de par√°metros clave.
- **Flexibilidad:** Permite un an√°lisis detallado por subgrupos (e.g., rural/urbano) sin comprometer la representatividad.

**Desventajas**

- **Complejidad:** Es m√°s dif√≠cil de implementar y puede ser m√°s costoso, dependiendo de la cantidad de estratos definidos.
- **Log√≠stica:** Aumenta la necesidad de coordinaci√≥n y planificaci√≥n.

**Incremento de presupuesto**

Si se aumenta el presupuesto, es m√°s eficiente incrementar el n√∫mero de conglomerados (distritos) en lugar de aumentar los estudiantes dentro de cada distrito. Esto mejora la precisi√≥n porque se ampl√≠a la cobertura geogr√°fica y la heterogeneidad entre conglomerados. Incrementar el tama√±o de muestra dentro de un conglomerado aumenta la redundancia debido a la homogeneidad intr√≠nseca.

**Recomendaci√≥n final**

Un dise√±o por conglomerados es viable, pero un dise√±o estratificado podr√≠a ofrecer ventajas significativas en precisi√≥n, especialmente con un mayor presupuesto. Si se mantiene el dise√±o por conglomerados, priorice aumentar el n√∫mero de distritos seleccionados como UPM para optimizar la diversidad y mejorar la calidad de las estimaciones.

#### Pregunta 2 (Palabras: 200)

Un hacedor de pol√≠ticas p√∫blicas que cuenta con conocimientos intermedios de estad√≠stica le pide que utilice la Encuesta Nacional Agropecuaria m√°s reciente para obtener estad√≠sticas distritales de acceso a asistencia t√©cnica en agricultores de Cajamarca. Estos datos ser√°n utilizados en el dise√±o de un programa p√∫blico de apoyo a los productores.
Expl√≠quele al funcionario si esto es posible y por qu√©. En caso no sea posible, prop√≥ngale qu√© otra fuente de datos podr√≠a usarse y cu√°les ser√≠an sus ventajas y desventajas.

-**Respuesta:**
Para responder su solicitud, es importante analizar las limitaciones y potencial de la Encuesta Nacional Agropecuaria (ENA) m√°s reciente. La ENA generalmente es dise√±ada para producir estad√≠sticas confiables a nivel nacional, regional o departamental, pero no necesariamente a nivel distrital. Si los tama√±os de muestra de la ENA en los distritos de Cajamarca son insuficientes o no representativos, las estimaciones distritales pueden ser poco precisas o carecer de validez estad√≠stica. Esto ocurre porque la muestra puede no ser lo suficientemente grande para capturar las caracter√≠sticas de cada distrito de manera confiable.
En caso de que no sea posible usar la ENA, se podr√≠an explorar otras fuentes de datos, como censos agropecuarios o encuestas especializadas. 

Por ejemplo:

- Censo Nacional Agropecuario: Proporciona datos exhaustivos a nivel distrital, pero puede estar desactualizado si no se ha realizado recientemente.
- Encuestas focalizadas o locales: Dise√±ar una encuesta espec√≠fica para los distritos de Cajamarca permitir√≠a recolectar informaci√≥n detallada. Ventajas: datos precisos y relevantes para los objetivos del programa. Desventajas: mayor costo y tiempo para su implementaci√≥n.
- Sistemas de informaci√≥n regionales o registros administrativos: Si existen registros locales de asistencia t√©cnica, podr√≠an complementar la ENA. Sin embargo, la calidad y cobertura de los datos pueden ser limitadas.

Se sugiere evaluar estas alternativas considerando el tiempo, recursos y alcance del programa.